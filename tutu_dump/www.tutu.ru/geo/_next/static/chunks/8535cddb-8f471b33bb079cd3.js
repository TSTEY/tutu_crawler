"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[129],{90646:function(e,t,r){r.d(t,{iI:function(){return ToursFormView},re:function(){return createToursFormModel}});var a=r(12443),n=r(86827),o=r(83016),s=r(48344),i=r(57632);r(5917),r(8638);var l=r(31748),u=r(824),m=r(67294),c=r(90512),d=r(59829),p=r(39463),h=r(76105),g=r(47996),y=r(20902),f=r(67803),b=r(12280),E=r(53828),P=r(27484),T=r.n(P),v=r(29387),C=r.n(v),D=r(70178),w=r.n(D),_=r(47349),S=r(96740),k=r(41506),x=r(20003),N=r(84332),M=r(37947),I=r(64629),z=r(70600),A=r.n(z),O=r(10285),F=r.n(O),$=r(65344),R=r(29486),V=r(21652),Z=r(24265),j=r(251),L=r(44891),q=r(72276),H=r(38629);r(33498),r(7677);var B=r(84437),Y=r(6905);r(12452);var W=r(61596),G=r(33486);r(77020),r(71438),r(79746),r(36565),r(975),r(59697),r(60827),r(32546);var Q=r(27430),K=r(46704),J=r(25405),X=r(71501),U=r(19689),ee=r(55453);r(4427),r(83669),r(18013),r(31498),r(2619),r(85150),r(88646),r(18029);let LastSearch=class LastSearch{constructor(){this.getCookie=s.ej,this.setCookie=s.d8}setLastSearch(e){let t=this.searchParamsToCookieValue(e);this.setCookie(this.cookieName,t,{expires:604800})}getLastSearch(){let e=this.getCookie(this.cookieName);return e?this.cookieValueToSearchParams(e):null}};let Travelers=class Travelers{constructor(e){this.add=e=>{this.state.list.push({id:this.getNewId(),age:e})},this.remove=e=>{let t=this.state.list.findIndex(t=>t.id===e);this.state.list.splice(t,1)},this.state=(0,a.sj)({list:e&&0!==e.length?e:[{id:1,age:null}]})}get list(){return this.state.list}getNewId(){return Math.max(0,...this.state.list.map(e=>e.id))+1}getCountsByType(){let e=0,t=0,r=0;return this.state.list.forEach(a=>{null===a.age?e++:null!==this.infantMaxAge&&a.age<=this.infantMaxAge?r++:null===this.childMaxAge||a.age<=this.childMaxAge?t++:e++}),{adult:e,child:t,infant:r}}splitAdults(){return this.state.list.reduce((e,t)=>null===t.age?{...e,adults:[...e.adults,t]}:null===this.childMaxAge||t.age<=this.childMaxAge?{...e,children:[...e.children,t]}:{...e,adults:[...e.adults,t]},{adults:[],children:[]})}};let CommonFormModel=class CommonFormModel{constructor({searchParams:e,validator:t,searchParamsInitializer:r,submitter:n,lastSearch:o,renderEmptyFieldsOnSsr:s=!0}){this.init=()=>{if(this.state.initiated)return;let e=this.lastSearch.getLastSearch();e&&Object.assign(this.state.searchParams,e),this.state.initiated=!0},this.state=(0,a.sj)({validationEnabled:!1,initiated:!!e,searchParams:(0,a.sj)(r.getInitialSearchParams(e)),submitted:!1}),this.validator=t,this.submitter=n,this.lastSearch=o,this.searchParamsInitializer=r,s||this.init()}get searchParams(){return this.state.searchParams}submit(){this.state.validationEnabled=!0,this.validator.validate(this.searchParams).isValid&&(this.state.submitted=!0,this.lastSearch.setLastSearch(this.searchParams),this.submitter.gotoOffers(this.searchParams))}get submitted(){return this.state.submitted}get validationResult(){return this.validator.validate(this.searchParams)}setSearchParams(e){this.state.initiated=!0,Object.assign(this.state.searchParams,this.searchParamsInitializer.getInitialSearchParams(e))}};function isDateWithDotsFormat(e){return!!("string"==typeof e&&/^(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[0-2])\.\d{4}$/.test(e))}function isNotEmptyString(e){return!!e&&"string"==typeof e}let CommonTransformFormModel=class CommonTransformFormModel extends CommonFormModel{constructor(){super(...arguments),this.swapGeoPoints=(e=0)=>{let{from:t,to:r}=this.searchParams.routes[e];this.searchParams.routes[e].from=r,this.searchParams.routes[e].to=t}}};(0,u.S1)().rules({routes:(0,u.pb)((0,u.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type,pointsAreEqual:(e,{data:{to:t}})=>"unknown"!==e.type&&"unknown"!==t.type&&e.aviaId===t.aviaId},to:{requiredTo:e=>!e||"unknown"===e.type,pointsAreEqual:(e,{data:{from:t}})=>"unknown"!==t.type&&"unknown"!==e.type&&t.aviaId===e.aviaId},date:{requiredDate:e=>!e,dateFormat:e=>{if(8!==e.length&&10!==e.length)return!0;let[t,r,a]=e.split(".");return t?.length!==2||2!==r.length||a?.length!==2&&a?.length!==4||isNaN(Number.parseInt(t,10))||isNaN(Number.parseInt(r,10))||isNaN(Number.parseInt(a,10))},inPast:e=>{let[t,r,a]=e.split("."),n=new Date(Number(a),Number(r)-1,Number(t),23,59,59).getTime(),o=new Date().getTime();return n<o}}}))}),T().extend(w()),T().extend(C());let formatDateTypeToTimestamp=e=>{let[t,r,a]=e.split("."),n=T().utc(`${a}-${r}-${t}`,"YYYY-MM-DD"),o=n.tz("Europe/Moscow");return o.valueOf()},et={hotel:"hotels",avia:"avia",train:"train",bus:"bus",etrain:"etrain",go:"trip",tours:"tour",aeroexpress:"aeroexpress",jarvel:"jarvel",multi:"all"},getDepartureDate=e=>{let t={};return e&&(t.departure_date=formatDateTypeToTimestamp(e)),t};function getBlock(e){return{block:"to"===e?"arrival":"departure"}}let getPassengersByAgesParams=e=>{let{adult:t,child:r,infant:a}=e.getCountsByType();return{adult_count:t,child_count:r,infant_count:a,child_age:e.splitAdults().children.map(e=>e.age)}};function getGeoId(e,t){let r=null;return t?.type==="aviaCity"&&(r=t.aviaId),t?.type==="trainStation"&&(r=t.rzdNumber),t?.type==="busStop"&&(r=t.busId),t?.type==="hotelDestination"&&(r=t.id),t?.type==="unknown"&&(r=t.name),r?{["to"===e?"arrival_geo_id":"departure_geo_id"]:r}:{}}let er={departure_city_error:"departure_city_error",arrival_city_error:"arrival_city_error",same_cities:"same_cities",wrong_date:"wrong_date"},getLoggingErrors$1=e=>{let t=e.result?.routes?.[0],r=[];return t?.from&&(t.from.requiredFrom&&r.push(er.departure_city_error),t.from.pointsAreEqual&&r.push(er.same_cities)),t?.to&&t.to?.requiredTo&&r.push(er.arrival_city_error),t?.date&&r.push(er.wrong_date),r};function useValidationTooltipTimeout({enabled:e,callback:t}){(0,m.useEffect)(()=>{if(e){let e=setTimeout(t,1e4);return()=>{clearTimeout(e)}}},[e])}let ea={xs:600};(0,_.Cu)({500:300,600:400,700:400});let en=(0,_.Cu)({500:200,600:200,700:300});(0,_.Cu)({500:700,600:750,700:800});let eo=(0,_.Cu)({500:"small",600:"small",700:"medium"}),es=(0,_.Cu)({500:"small",600:"medium",700:"medium"}),convertFormGroupSizeToCellSize=(e,t=!1)=>(t?es:eo)(e);function getThemeAttribute(e){return e?(0,S.kb)(e):{}}let ei={...A(),monthsShort:["янв","фев","мар","апр","мая","июня","июля","авг","сен","окт","ноя","дек"]},el="ru";function formatDateToView(e,t,r=el){return T()(e).locale(r,r===el?ei:void 0).format(t).replace(".","")}let eu="D MMM, dd",em="D MMMM, dd",datesToInputView=({dateFrom:e,dateTo:t,locale:r=el,short:a=!1})=>{if(e&&t){let a=formatDateToView(e,eu,r),n=formatDateToView(t,eu,r),o=formatDateToView(t,em,r),s=T()(e).date();return a===n?`${s} – ${o}`:`${a} – ${n}`}return e?a?formatDateToView(e,eu,r):formatDateToView(e,em,r):""},formatDateToString=e=>T()(e).format("DD.MM.YYYY");T().extend(F());let formatStringToDate=e=>T()(e,"DD.MM.YYYY").toDate(),ec=new Date,ed=new Date(ec.getFullYear(),ec.getMonth(),ec.getDate()+1),ep=new Date(ec.getFullYear(),ec.getMonth(),ec.getDate()+2);formatDateToString(ec),formatDateToString(ed),formatDateToString(ep);let debounce=(e,t)=>{let r;return(...a)=>new Promise(n=>{r&&clearTimeout(r),r=setTimeout(()=>n(e(...a)),t)})},useDebounce=(e,t)=>{let r=m.useRef();return m.useMemo(()=>(...a)=>new Promise(n=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{n(e(...a))},t)}),[e,t])};function useTooltipState(e,t=5e3){let r=(0,L.r)(),a=useDebounce(()=>{r.setOpen(!1)},t);return{state:r,handleAutoClose:()=>{e&&a()}}}function renderTooltipContent(e){return Array.isArray(e)?m.createElement(j.Rm,{sizeContrast:"small-small"},e.map(e=>m.createElement(Z.cM,{key:e,label:e,labelColor:"primary"}))):e?m.createElement(j.Rm,{sizeContrast:"small-small"},m.createElement(Z.cM,{label:e,labelColor:"primary"})):null}let ChildPassenger=({age:e,className:t,infantMaxAge:a,isDeleteDisabled:n=!1,autoCloseDeleteTooltip:o=!1,openDeleteTooltipOnClick:s=!1,deleteTooltipContent:i,deleteTooltipPosition:l,deleteTooltipSide:u,onTooltipOpen:c,onDeleteClick:h})=>{let g=(0,E.Ei)(e=>r(70594)(`./${e}/index.json`)),f=useTooltipState(o);return m.createElement(V.bL,{addonSize:"small",className:t,...(0,d.ZP)("child_passenger")},m.createElement(j.Rm,{sizeContrast:"medium-plain"},m.createElement(Z.cM,{label:g("title"),value:g("age",{found:0!==e,n:e}),emphasized:!0}),"number"==typeof a&&m.createElement(Z.cM,{label:g(e>a?"with_place":"without_place")})),m.createElement(V.e9,null,m.createElement(N.u,{state:f.state,content:renderTooltipContent(i),position:l,side:u,openOnClick:s,closeOnTooltipClick:!0,stopMouseDownPropagation:!0,onOpen:()=>{c?.(),f.handleAutoClose()}},({ref:e})=>m.createElement("div",{ref:e},m.createElement(p.zx,{disabled:n,leftAddon:m.createElement(y.V,{icon:"cross_outline",shape:"noShape",size:100}),size:200,color:"secondary-neutral",onClick:h,...(0,d.ZP)("child_passenger_delete_button")})))))},Counter=({value:e,onPlusClick:t,onMinusClick:a,plusTooltipContent:n,minusTooltipContent:o,isMinusDisabled:s=!1,isPlusDisabled:i=!1,openPlusTooltipOnClick:l=!1,openMinusTooltipOnClick:u=!1,onTooltipOpen:g,autoClosePlusTooltip:b=!1,autoCloseMinusTooltip:P=!1})=>{let T=(0,E.Ei)(e=>r(80408)(`./${e}/index.json`)),v=useTooltipState(P),C=useTooltipState(b);return m.createElement("div",{className:(0,c.W)(q.Z.wrapper,(0,h.j)("flex"))},m.createElement(N.u,{state:v.state,content:renderTooltipContent(o),position:"end",openOnClick:u,closeOnTooltipClick:!0,stopMouseDownPropagation:!0,onOpen:()=>{g?.("minus"),v.handleAutoClose()}},({ref:e})=>m.createElement("div",{ref:e},m.createElement(p.zx,{size:500,color:"secondary-neutral",disabled:s,onClick:a,type:"button","aria-label":T("removePassenger"),className:(0,f.o3)(200),leftAddon:m.createElement(y.V,{icon:"minus_outline",shape:"noShape",size:200}),...(0,d.ZP)("minus_button")}))),m.createElement("div",{className:q.Z.count,...(0,d.ZP)("count")},e),m.createElement(N.u,{state:C.state,content:renderTooltipContent(n),position:"end",openOnClick:l,closeOnTooltipClick:!0,stopMouseDownPropagation:!0,onOpen:()=>{g?.("plus"),C.handleAutoClose()}},({ref:e})=>m.createElement("div",{ref:e},m.createElement(p.zx,{size:500,color:"secondary-neutral",disabled:i,onClick:t,type:"button","aria-label":T("addPassenger"),className:(0,f.o3)(200),leftAddon:m.createElement(y.V,{icon:"plus_outline",shape:"noShape",size:200}),...(0,d.ZP)("plus_button")}))))},PassengersCounter=({value:e,onMinusClick:t,onPlusClick:r,title:a,subtitle:n,isMinusDisabled:o,isPlusDisabled:s,openPlusTooltipOnClick:i,openMinusTooltipOnClick:l,plusTooltipContent:u,minusTooltipContent:p,autoClosePlusTooltip:h,autoCloseMinusTooltip:g,className:y,onTooltipOpen:f})=>m.createElement(V.bL,{addonSize:"small",contrast:"small",size:"medium",className:(0,c.Z)(H.Z.cell,y),...(0,d.ZP)("passengers_counter")},m.createElement(j.Rm,null,m.createElement(Z.cM,{isLabelAccent:!0,label:a,emphasized:!0,...(0,d.ZP)("passengers_counter_title")}),m.createElement(Z.cM,{label:n,...(0,d.ZP)("passengers_counter_subtitle")})),m.createElement(V.e9,null,m.createElement(Counter,{value:e,isMinusDisabled:o,isPlusDisabled:s,openPlusTooltipOnClick:i,openMinusTooltipOnClick:l,plusTooltipContent:u,minusTooltipContent:p,autoClosePlusTooltip:h,autoCloseMinusTooltip:g,onMinusClick:t,onPlusClick:r,onTooltipOpen:f}))),eh=(0,m.createContext)(400);function RoutePointView({isDefaultItems:e,loadItems:t,point:r,setPoint:a,product:n,fieldName:o,label:s,hasError:i,errorMessage:u,onBlur:c,onFocus:d,inputRef:p,tabIndex:h,renderContent:g,items:y=[],selectOnClose:f,position:E,wrapperClassName:P,onErrorMessageClose:T,theme:v,searchId:C}){let{userway:D}=(0,b.w5)(),w=f??!e,_=(0,l.Vt)({value:{xs:"modal",lg:"dropdown"}}),S=(0,L.r)(),[k,M]=m.useState(""),handleModalCloseClick=()=>{D?.({title:"search_form_close_city_suggest_click",product:et[n],...getBlock(o)})},handleInputClear=()=>{D?.({title:"search_form_clean_city_field_click",product:et[n],...getBlock(o)})},handleValueSelect=e=>{a(e.hiddenValue.geoPoint),D?.({title:"search_form_select_city_click",product:et[n],...getBlock(o),...getGeoId(o,e.hiddenValue?.geoPoint),total_number_of_suggests:y.length,number_of_typed_symbols:("modal"===_?k:r.name).length,position_click:e.hiddenValue?.index,hint_type_click:getItemTypeForLog(e),hint_types_available:y.map(getItemTypeForLog).filter((e,t,r)=>r.indexOf(e)===t)})},handleMouseDown=()=>{D?.({title:"search_form_city_field_click",product:et[n],...getGeoId(o,r),...C?{search_id:C}:{}})},handleOpen=()=>{D?.({title:"search_form_city_suggest_shown",product:et[n],...getBlock(o),type:"special",total_number_of_suggests:y.length,element_state:"click"})},I=(0,m.useContext)(eh),z=(0,m.useMemo)(()=>debounce(e=>{t(e)},I),[t,I]);return m.useEffect(()=>{"dropdown"===_&&z(r.name),"modal"===_&&z(S.isOpen?k:"")},[_,S,k,r.name,z]),useValidationTooltipTimeout({enabled:!!u,callback:T}),m.createElement(N.X,{open:!!u,content:m.createElement(x.Dr,{color:"primary"},u),side:"modal"===_?"bottom":"top",maxWidth:"targetWidth",onClick:T,onClickOutside:T,position:"start"},({ref:e})=>m.createElement(W.qY,{...S,wrapperClassName:P,position:E,tabIndex:h,onFocus:d,onBlur:c,ref:p,containerRef:e,containerStyle:_??"modal",value:r.name,items:y,label:s,modalProps:{title:s,minHeight:"99%",...getThemeAttribute(v)},hasError:i,modalInputProps:{placeholder:r.name,value:k,onChange:e=>{M(e.currentTarget.value)}},dropdownProps:{maxHeight:450,minWidth:"300px",flip:!1,...getThemeAttribute(v)},onChange:e=>{r.name!==e.currentTarget.value&&a({type:"unknown",name:e.currentTarget.value})},onValueSelect:handleValueSelect,renderContent:g,onClose:e=>{e.items&&e.items.length>0&&"dropdown"===e.style&&"select"!==e.reason&&""!==r.name&&"unknown"===r.type&&w&&a(e.items[0].hiddenValue.geoPoint),M(""),"modal"===e.style&&"closeButton"===e.reason&&handleModalCloseClick()},onMouseDown:handleMouseDown,onClear:handleInputClear,selectFirstItemOnEnterKeyPress:"modal"===_?""!==k:""!==r.name,onOpen:handleOpen,wrapperProps:getThemeAttribute(v)}))}function getItemTypeForLog(e){return e.hiddenValue?.isNearest?"nearest":"popular"}(0,m.memo)(e=>{let{fieldName:t,suggest:a}=e,o=(0,E.Ei)(e=>r(46037)(`./${e}/index.json`)),{items:s,isError:i}=(0,n.R)(a).getItems({fieldName:t});if(i&&0===s.length)return m.createElement(W.vQ,null,o("error"));let l=0;return s.map((e,t)=>{let r=s.length-1===t;return e.hasNoAirport?m.createElement(m.Fragment,{key:e.geoPoint.aviaId},m.createElement(V.bL,{addonSize:"none",size:"medium",contrast:"plain",...(0,d.yT)("no-airport-item")},m.createElement(j.Rm,null,m.createElement(Z.cM,{label:e.geoPoint.name,isLabelAccent:!0,labelColor:"secondary",value:o("no_airport"),isValueNumeric:!0,isValueAccent:!0,emphasized:!0}),e.country&&m.createElement(Z.cM,{label:e.country.name}))),(e.closestCities??[]).length>0&&m.createElement(m.Fragment,null,m.createElement(W.to,null,m.createElement(Z.cM,{label:o("nearest_cities"),isLabelAccent:!0,labelColor:"secondary"})),e.closestCities.map((t,a)=>m.createElement(W.uj,{value:`${l++}_${t.geoPoint.aviaId}`,key:t.aviaCode,className:r||a!==e.closestCities.length-1?void 0:$.Z.lastCity,addonSize:"none",hasSeparator:!r&&a===e.closestCities.length-1},m.createElement(j.Rm,null,m.createElement(Z.cM,{label:t.geoPoint.name,value:t.aviaCode,isLabelAccent:!0,emphasized:!0}),(t.distance||t.country)&&m.createElement(Z.cM,{label:t.distance?`${t.distance}${o("distance_unit")}`:t.country?.name})))))):m.createElement(W.uj,{value:`${l++}_${e.geoPoint.aviaId}`,key:e.aviaCode},m.createElement(j.Rm,null,m.createElement(Z.cM,{label:e.geoPoint.name,isLabelAccent:!0,value:e.aviaCode,emphasized:!0}),e.country&&m.createElement(Z.cM,{label:e.country.name})))})}),(0,u.S1)().rules({routes:(0,u.pb)((0,u.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type,pointsAreEqual:(e,{data:{to:t}})=>"unknown"!==e.type&&"unknown"!==t.type&&e.busId===t.busId},to:{pointsAreEqual:(e,{data:{from:t}})=>"unknown"!==t.type&&"unknown"!==e.type&&t.busId===e.busId},date:{inPast:e=>{if(!e)return!1;let[t,r,a]=e.split("."),n=new Date(Number(a),Number(r)-1,Number(t),23,59,59).getTime(),o=new Date().getTime();return n<o}}}))}),(0,m.memo)(e=>{let{fieldName:t,suggest:a}=e,o=(0,E.Ei)(e=>r(57892)(`./${e}/index.json`)),{items:s,isError:i}=(0,n.R)(a).getItems({fieldName:t});return i&&0===s.length?m.createElement(W.vQ,null,o("error")):s.map(e=>{let t=[e.country?.name,e.region?.name,e.district?.name].filter(Boolean).join(", ");return m.createElement(W.uj,{value:e.geoPoint.busId,key:e.geoPoint.busId},m.createElement(j.Rm,null,m.createElement(Z.cM,{label:e.geoPoint.name,isLabelAccent:!0,emphasized:!0}),t&&m.createElement(Z.cM,{label:t})))})});let eg={find_tickets:"Найти автобусы",today:"Сегодня",tomorrow:"Завтра",from:"Откуда",to:"Куда",when:"Когда",who:"Кто едет",requiredFrom:"Выберите место отправления",pointsAreEqual:"Места отправления и\xa0назначения не\xa0должны совпадать",inPast:"Выберите не\xa0прошедшую дату",swapGeoPoints:"Поменять местами отправление и прибытие"},ey=new Date,ef=new Date(ey.getFullYear(),ey.getMonth(),ey.getDate()+1);(0,G.ZP)(eg,"today"),formatDateToString(ey),(0,G.ZP)(eg,"tomorrow"),formatDateToString(ef),(0,u.S1)().rules({point:{requiredPoint:e=>!e||"unknown"===e.type},date:{requiredDate:e=>!e,dateFormat:e=>{if(8!==e.length&&10!==e.length)return!0;let[t,r,a]=e.split(".");return t?.length!==2||2!==r.length||a?.length!==2&&a?.length!==4||isNaN(Number.parseInt(t,10))||isNaN(Number.parseInt(r,10))||isNaN(Number.parseInt(a,10))},datesAreEqual:(e,{data:{secondDate:t}})=>e&&t&&e===t,inPast:e=>{let[t,r,a]=e.split("."),n=new Date(Number(a),Number(r)-1,Number(t),23,59,59).getTime(),o=new Date().getTime();return n<o}},secondDate:{requiredDate:e=>!e,dateFormat:e=>{if(8!==e.length&&10!==e.length)return!0;let[t,r,a]=e.split(".");return t?.length!==2||2!==r.length||a?.length!==2&&a?.length!==4||isNaN(Number.parseInt(t,10))||isNaN(Number.parseInt(r,10))||isNaN(Number.parseInt(a,10))},datesAreEqual:(e,{data:{date:t}})=>t&&e&&t===e,inPast:e=>{let[t,r,a]=e.split("."),n=new Date(Number(a),Number(r)-1,Number(t),23,59,59).getTime(),o=new Date().getTime();return n<o}}}),(0,m.memo)(e=>{let{suggest:t}=e,a=(0,E.Ei)(e=>r(94872)(`./${e}/index.json`)),{items:o,isError:s}=(0,n.R)(t).getItems();if(s&&0===o.length)return m.createElement(W.vQ,null,a("error"));let i=function(e){let t={};return e.forEach(e=>{let r=function(e){switch(e){case"country":return"country";case"airport":return"airport";case"hotel":return"hotel";case"sight":return"sight";default:return"region"}}(e.geoPoint.geoType);Array.isArray(t[r])?t[r].push(e):t[r]=[e]}),Object.entries(t)}(o);return i.map(([e,t])=>m.createElement(m.Fragment,{key:e},e&&m.createElement(W.to,null,m.createElement(x.Dr,{size:"header-xx-small"},a(e))),t.map(t=>m.createElement(W.uj,{value:t.geoPoint.id,key:t.geoPoint.id},m.createElement(j.Rm,null,m.createElement(Z.cM,{label:t.geoPoint.name,value:"region"===e&&t.hotelsCount?t.hotelsCount:void 0,isLabelAccent:!0,emphasized:!0}),t.description&&m.createElement(Z.cM,{label:t.description}))))))});let eb=(0,u.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type},to:{requiredTo:e=>!e||"unknown"===e.type,sameStation:(e,{data:t,meta:r})=>!!r.stationPageTransitionDisabled&&"trainStation"===t.from.type&&"trainStation"===e.type&&t.from.rzdNumber===e.rzdNumber},date:{requiredDate:(e,{meta:t})=>!!t.withoutDateDisabled&&!e}});(0,u.S1)().rules({routes:(0,u.Hk)("meta",(0,u.pb)((0,u.Hk)("meta",eb)))}),(0,m.memo)(e=>{let{fieldName:t,suggest:a}=e,o=(0,E.Ei)(e=>r(5639)(`./${e}/index.json`)),{items:s,isError:i}=(0,n.R)(a).getItems({fieldName:t});return i&&0===s.length?m.createElement(W.vQ,null,o("error")):s.map(e=>m.createElement(W.uj,{value:e.geoPoint.rzdNumber,key:e.geoPoint.rzdNumber},m.createElement(V.bL,{addonSize:"none"},m.createElement(Z.cM,{label:e.geoPoint.name,isLabelAccent:!0,emphasized:!0,...(0,d.ZP)("suggest-item-name")}))))});let eE={find_tickets:"Найти поезда",today:"Сегодня",tomorrow:"Завтра",from:"Откуда",to:"Куда",when:"Когда",select_departure_location:"Выберите место отправления",select_arrival_location:"Выберите место прибытия",select_arrival_location_different:"Места отправления и\xa0назначения не\xa0должны совпадать",swapGeoPoints:"Поменять местами отправление и прибытие",select_date:"Выберите дату"};(0,G.ZP)(eE,"select_departure_location"),(0,G.ZP)(eE,"select_arrival_location"),(0,G.ZP)(eE,"select_arrival_location_different"),(0,G.ZP)(eE,"select_date");let eP=new Date,eT=new Date(eP.getFullYear(),eP.getMonth(),eP.getDate()+1);(0,G.ZP)(eE,"today"),formatDateToString(eP),(0,G.ZP)(eE,"tomorrow"),formatDateToString(eT),(0,u.S1)().rules({routes:(0,u.pb)((0,u.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type},to:{requiredTo:e=>!e||"unknown"===e.type}}))}),(0,u.S1)().rules({routes:(0,u.pb)((0,u.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type}}))}),(0,m.memo)(e=>{let{fieldName:t,suggest:a}=e,o=(0,E.Ei)(e=>r(20426)(`./${e}/index.json`)),{items:s,isError:i}=(0,n.R)(a).getItems({fieldName:t});return i&&0===s.length?m.createElement(W.vQ,null,o("error")):s.map(e=>m.createElement(W.uj,{value:e.geoPoint.stationId,key:e.geoPoint.stationId},m.createElement(V.bL,{addonSize:"none"},m.createElement(Z.cM,{label:e.geoPoint.name,isLabelAccent:!0,emphasized:!0,...(0,d.ZP)("suggest-item-name")}))))});let ev={show_schedule:"Показать расписание",today:"Сегодня",tomorrow:"Завтра",from:"Откуда",to:"Куда",when:"Когда",select_departure_location:"Выберите станцию отправления",select_arrival_location:"Выберите станцию прибытия",swap_geo_points:"Поменять местами отправление и прибытие",station_name:"Название станции"};(0,G.ZP)(ev,"select_departure_location"),(0,G.ZP)(ev,"select_arrival_location");let eC=new Date,eD=new Date(eC.getFullYear(),eC.getMonth(),eC.getDate()+1);(0,G.ZP)(ev,"today"),formatDateToString(eC),(0,G.ZP)(ev,"tomorrow"),formatDateToString(eD),(0,G.ZP)(ev,"select_departure_location"),(0,G.ZP)(ev,"select_arrival_location");let ew=new Date,e_=new Date(ew.getFullYear(),ew.getMonth(),ew.getDate()+1);(0,G.ZP)(ev,"today"),formatDateToString(ew),(0,G.ZP)(ev,"tomorrow"),formatDateToString(e_);let eS=[{id:76,name:"Россия",type:"country",country:0},{id:92,name:"Турция",type:"country",country:0},{id:87,name:"Таиланд",type:"country",country:0},{id:29,name:"Египет",type:"country",country:0},{id:3097,name:"Сочи",type:"resort",country:76},{id:1651,name:"Калининград",type:"resort",country:76},{id:2161,name:"Анталья",type:"resort",country:92},{id:3839,name:"Кемер",type:"resort",country:92},{id:4191,name:"о. Пхукет",type:"resort",country:87},{id:2098,name:"о. Самуи",type:"resort",country:87},{id:597,name:"Хургада",type:"resort",country:29},{id:598,name:"Шарм-Эль-Шейх",type:"resort",country:29}],ek=[{id:"2",name:"Москва",type:"toursDeparture",disabled:!1},{id:"1",name:"Санкт-Петербург",type:"toursDeparture",disabled:!1}],ex=[{id:"76",name:"Россия",type:"toursDestination",geoType:"country",country:0},{id:"92",name:"Турция",type:"toursDestination",geoType:"country",country:0}],eN={requiredFrom:"Выберите город вылета",requiredTo:"Выберите направление",requiredDate:"Выберите дату вылета",dateFormat:"Неправильный формат даты",inPast:"Выберите не\xa0прошедшую дату"};let ToursTravelers=class ToursTravelers extends Travelers{get infantMaxAge(){return 1}get childMaxAge(){return 17}};let ToursSearchParamsInitializer=class ToursSearchParamsInitializer{getInitialSearchParams(e){let t=getToursInitialSearchParams();if(!e)return t;let r=this.convertOuterSearchParams(e);return{routes:r.routes??t.routes,travelers:r.travelers??t.travelers,nightsRange:r.nightsRange??t.nightsRange}}convertOuterSearchParams(e){let t=e?.routes[0];return{routes:[{from:t.from?{type:"toursDeparture",name:t.from.value,id:t.from.id,disabled:t.from.disable}:{type:"unknown",name:""},to:t.to?{type:"toursDestination",name:t.to.value,id:t.to.id,country:t.to.country,geoType:t.to.geoType}:{type:"unknown",name:""},date:t.date??void 0}],...e.travelers?{travelers:new ToursTravelers(e.travelers)}:{},...e.nightsRange?{nightsRange:e.nightsRange}:{from:7,to:14}}}};function getToursInitialSearchParams(){return{routes:[{from:{type:"unknown",name:""},to:{type:"unknown",name:""},date:void 0}],travelers:new ToursTravelers,nightsRange:{from:7,to:14}}}function isDeparturePoint(e){return!!e&&"object"==typeof e&&"type"in e&&"id"in e&&"name"in e&&"toursDeparture"===e.type&&isNotEmptyString(e.id)&&isNotEmptyString(e.name)}function isDestinationPoint(e){return!!e&&"object"==typeof e&&"type"in e&&"id"in e&&"name"in e&&"toursDestination"===e.type&&isNotEmptyString(e.id)&&isNotEmptyString(e.name)}let createToursCookiesData=({routes:e,travelers:t,nightsRange:r})=>{let{date:a,to:n,from:o}=e[0],s=isDeparturePoint(o)?`fid::${o.id};f::${o.name};`:"",i=isDestinationPoint(n)?`tid::${n.id};t::${n.name};tt::${n.geoType};tc::${n.country};`:"",l=isDateWithDotsFormat(a)?`d::${a};`:"",u=t.list.map(({age:e})=>e),m=t.list.length?`tr::${JSON.stringify(u)};`:"",c=r?Object.values(r):[],d=c.length?`n::${JSON.stringify(c)};`:"";return`${s}${i}${l}${m}${d}`},decryptToursCookies=(e,t)=>{var r;let a=e?.split(";"),n={tr:"[null]",f:"",fid:"",t:"",tid:"",tc:"",tt:"",d:void 0,n:""};a?.forEach(e=>{let t=e.split("::"),[r,a]=t;r&&a&&(n[r]=a)});let o={type:"toursDeparture",name:n.f,id:n.fid,disabled:!1},s={type:"toursDestination",name:n.t,id:n.tid,country:n.tc,geoType:n.tt},i=isDeparturePoint(o)?o:t.routes[0].from,l=isDestinationPoint(s)?s:t.routes[0].to,u=function(e,t=[{id:1,age:null}]){try{let r=JSON.parse(e);if(!Array.isArray(r)||0===r.length)return t;let a=[];for(let e=0;e<r.length;e++){let n=r[e];if(("number"!=typeof n||Number.isNaN(n))&&("object"!=typeof n||n))return t;a.push({id:e+1,age:n})}return a}catch(e){return t}}(n.tr),m=function(e,t={from:7,to:14}){try{let r=JSON.parse(e);if(!Array.isArray(r)||0===r.length||r.length<2)return t;return{from:r[0],to:r[1]}}catch(e){return t}}(n.n);return{routes:[{from:i,to:l,date:isDateWithDotsFormat(r=n.d)?r:void 0}],travelers:new ToursTravelers(u),nightsRange:m}};let ToursLastSearch=class ToursLastSearch extends LastSearch{constructor(){super(...arguments),this.initialSearchParams=getToursInitialSearchParams(),this.toursCookieName="sf_tours"}searchParamsToCookieValue(e){return createToursCookiesData(e)}cookieValueToSearchParams(e){return decryptToursCookies(e,this.initialSearchParams)}get cookieName(){return this.toursCookieName}};let ToursSubmitter=class ToursSubmitter{constructor(e){this.toursOffersHost=e.toursHost,this.utmParams=e.utmParams}gotoOffers(e){this.toursSearchId=(0,i.Z)();let t=this.toursOffersHost.replace("https://","").replace("http://","");this.openOffersPage((0,Q.i)({searchParams:this.getExternalSearchParams(e),utmParams:this.utmParams,host:t}))}openOffersPage(e){location.href=e}getExternalSearchParams(e){let{adults:t,children:r}=e.travelers.splitAdults(),a=r.map(({age:e})=>String(e)),n={id:e.routes[0].from.id},o={id:e.routes[0].to.id,type:e.routes[0].to.geoType??"",text:e.routes[0].to.name},s={ages:a,adults:t.length,children:r.length},i={min:e.nightsRange.from,max:e.nightsRange.to};return{departure:n,arrival:o,tourists:s,nights:i,startDate:e.routes[0].date}}get searchId(){return this.toursSearchId}};let eM=new Set([1,2]),convertDestinationsItems=e=>e.map(e=>({type:"geoPoint",geoPoint:{id:String(e.id),type:"toursDestination",name:e.name??"",geoType:e.type??null,country:e.country}})),convertDepartureItems=e=>e.map(e=>({type:"geoPoint",geoPoint:{id:String(e.id),type:"toursDeparture",name:e.name??"",disabled:e.disabled}}));let ToursSuggestLoader=class ToursSuggestLoader{get fetch(){return(...e)=>fetch(...e)}constructor(e){this.toursApiHost=(0,o.n)(e)}async handleApiResponse(e,t){let r=await this.fetch(e,t).then(e=>e.json());if(!r.success)throw Error(r.error?.message||"Unknown api error");return r.result||[]}async getSuggestedDepartureCities(){let e=await this.handleApiResponse(`${this.toursApiHost}/partners/directory/departureCities`,{method:"GET"}),t=e.filter(e=>!e.disabled).sort((e,t)=>{let r=eM.has(e.id)?1:0,a=eM.has(t.id)?1:0;return r!==a?a-r:e.name.localeCompare(t.name)});return convertDepartureItems(t)}async getSuggestedDestinations({request:{value:e},abortController:t}){let r=new URLSearchParams({term:e}),a=await this.handleApiResponse(`${this.toursApiHost}/partners/directory/destinations?${r}`,{method:"GET",signal:t.signal});return convertDestinationsItems(a)}};let ToursFormModel=class ToursFormModel extends CommonTransformFormModel{constructor({suggest:e,calendarApiHost:t,holidaysApiHost:r,...a}){super(a),this.suggest=e,this.calendarApiHost=t,this.holidaysApiHost=r}};let ToursSuggest=class ToursSuggest{constructor(e,t){this.loader=e,this.logError=t,this.destinations=(0,a.sj)({items:[],prevRequest:null,abortController:null,isError:!1,isDefaultItems:!1}),this.departures=(0,a.sj)({items:[],isError:!1,isDefaultItems:!1}),this.loadDestinations=async({value:e})=>{try{let t={value:e},r=this.destinations?.prevRequest;if(!r||r.value!==t.value){this.destinations?.abortController?.abort?.();let e=new AbortController;this.destinations?(this.destinations.abortController=(0,a.iH)(e),this.destinations.prevRequest=t):this.destinations={items:[],abortController:(0,a.iH)(e),prevRequest:t,isError:!1,isDefaultItems:!1};let r=await this.getDestinationsItems({request:t,abortController:e});if(r.length>0)this.destinations.items=r,this.destinations.isDefaultItems=!1;else{let e=new AbortController;this.destinations.abortController=(0,a.iH)(e),this.destinations.items=await this.getDestinationsItems({request:{value:""},abortController:e}),this.destinations.isDefaultItems=!0}this.destinations.isError=!1}}catch(e){if("name"in e&&("AbortError"===e.name||"CancelError"===e.name))return;if(this.destinations.isError=!0,this.destinations.items=[],this.logError)this.logError(e);else throw e}finally{this.destinations.abortController=null}},this.loadDepartures=async()=>{if(!(this.departures.items.length>0))try{this.departures.isError=!1,this.departures.items=await this.loader.getSuggestedDepartureCities()}catch(e){if(this.departures.isError=!0,this.departures.items=[],this.logError)this.logError(e);else throw e}}}async getDestinationsItems(e){return e.request.value?this.loader.getSuggestedDestinations(e):convertDestinationsItems(eS)}splitDestinationsByType(){let e=this.destinations?.items||[],t={};return e.forEach(e=>{let r=e.geoPoint.geoType;r&&(Array.isArray(t[r])?t[r].push(e):t[r]=[e])}),Object.entries(t)}getDestinations(){return{items:this.destinations?.items??[],isError:this.destinations?.isError??!1,isDefaultItems:this.destinations?.isDefaultItems??!1}}getDepartures(){return{items:this.departures?.items??[],isError:this.departures?.isError??!1,isDefaultItems:this.departures?.isDefaultItems??!1}}};let eI=(0,u.S1)().rules({routes:(0,u.pb)((0,u.S1)().rules({from:{requiredFrom:e=>!e||"unknown"===e.type},to:{requiredTo:e=>!e||"unknown"===e.type},date:{requiredDate:e=>!e,inPast:e=>{let[t,r,a]=e.split("."),n=new Date(Number(a),Number(r)-1,Number(t),23,59,59).getTime(),o=new Date().getTime();return n<o},dateFormat:e=>{if(8!==e.length&&10!==e.length)return!0;let[t,r,a]=e.split(".");return t?.length!==2||2!==r.length||a?.length!==2&&a?.length!==4||isNaN(Number.parseInt(t,10))||isNaN(Number.parseInt(r,10))||isNaN(Number.parseInt(a,10))}}}))});let ToursValidator=class ToursValidator{validate(e){let t=eI.validate(e);return{result:t,isValid:null===t}}};let NightsSelectionModalContent=({nightsRange:e})=>{let t=(0,n.R)(e),a=(0,E.Ei)(e=>r(44503)(`./${e}/index.json`)),o=t.to,s=t.from;return m.createElement(K.M,{sliderPosition:"bottom",sliderProps:{hasStartKnob:!0,max:29,min:1,onChange:(t,r)=>{let{toKnobValue:a,fromKnobValue:n}=r??{};a&&n&&(e.to=Math.round(a),e.from=Math.round(n))},startKnobValue:s,value:o},...(0,d.ZP)("nights_slider")},m.createElement(Z.cM,{label:a("from_value",{from:s}),value:a("to_value",{to:o})}))},NightsSelectionModal=({searchParams:e,initiated:t,theme:a})=>{let[o,s]=m.useState(!1),i=(0,E.Ei)(e=>r(44503)(`./${e}/index.json`)),l=(0,n.R)(e),{from:u,to:c}=l.nightsRange,d=i("input_value",{from:u,to:c,showRange:u!==c}),handleInputFocus=()=>{s(!o)};return m.createElement(R.z,{size:700,containerStyle:{xs:"modal",lg:"dropdown"},isOpen:o,renderContent:()=>m.createElement(NightsSelectionModalContent,{nightsRange:e.nightsRange}),setOpen:s,modalProps:{title:i("mobile_title"),closeOnClickOutside:!0,closeOnCloseButtonClick:!0,minHeight:"auto",stopMouseDownPropagation:!1},dropdownProps:{closeOnClickOutside:!0,position:"start",minWidth:"300px"}},({ref:e})=>m.createElement(k.I,{wrapperClassName:`${J.Z.nights} ${(0,f.yl)({xs:300,lg:0})}`,containerRef:e,position:{lg:"middle-horizontal",xl:"middle-horizontal"},"data-ti":"nights_input",type:"text",label:i("input_label"),value:t?d:"",onFocus:handleInputFocus,readOnly:!0,clearButtonType:"hidden",wrapperProps:getThemeAttribute(a)}))},ez={when:"Когда",today:"Сегодня",tomorrow:"Завтра"},eA=new Date,eO=new Date(eA.getFullYear(),eA.getMonth(),eA.getDate()+1),eF={name:(0,G.ZP)(ez,"today"),date:formatDateToString(eA)},e$={name:(0,G.ZP)(ez,"tomorrow"),date:formatDateToString(eO)},eR=[eF,e$],ToursDates=({model:e,inputsTheme:t,hideHints:a=!1,onDateFocus:o,showDateValidationTooltip:s,onHideDateValidationTooltip:i,errorText:l,size:u})=>{let c=(0,E.Ei)(e=>r(22596)(`./${e}/index.json`)),y=(0,M.H)({min:"lg"}),b=(0,n.R)(e),{validationEnabled:P}=b.state,{result:T}=P?b.validationResult:{result:null},v=(0,I.n)({dateFrom:b.searchParams.routes[0].date?formatStringToDate(b.searchParams.routes[0].date):null,onChangeDates:(0,m.useCallback)(t=>{e.searchParams.routes[0].date=t.dateFrom?formatDateToString(t.dateFrom):void 0},[e]),isOneway:!0}),C=(0,m.useMemo)(()=>({from:b.searchParams.routes[0].from.id,to:b.searchParams.routes[0].to.id}),[b.searchParams.routes]),D=(0,m.useMemo)(()=>b.searchParams.travelers.list.map(({age:e})=>({age:e})),[b.searchParams.travelers.list]),renderDateHints=()=>a?null:m.createElement("div",{className:`${(0,h.j)({xs:"none",xl:"inline-flex"})} ${(0,f.E9)(200)} ${(0,f.SG)(100)}`},eR.map(t=>m.createElement(p.zx,{color:"secondary-neutral",size:en(u),key:t.name,onClick:()=>{e.searchParams.routes[0].date=t.date},...(0,d.ZP)("dateHint")},t.name)));return m.createElement(I.S,{...v,withAnimation:!1,product:"tours",block:"search_form",apiHost:b.calendarApiHost,calendarHost:b.holidaysApiHost,isDesktop:y??!0,cityIds:C,popupContentClassName:X.Z.calendarPopup,travelers:D,target:({fromRef:e})=>m.createElement("div",{className:X.Z.targetDate},m.createElement(N.X,{open:s,content:m.createElement(x.Dr,{color:"primary"},l),side:"top",onClick:i,onClickOutside:i,position:"start",targetRef:e},({ref:e})=>m.createElement(k.I,{wrapperClassName:`${X.Z.date} ${(0,g.dm)({xs:["bottom"],lg:["none"]})}`,onChange:()=>{},wrapperProps:getThemeAttribute(t),position:{xs:"bottom",lg:"left",xl:"middle-horizontal"},containerRef:e,"data-ti":"trip-dates",type:"text",label:c("when"),value:datesToInputView({dateFrom:v.chosenDates.dateFrom,dateTo:v.chosenDates.dateTo}),hasError:P&&!!T?.routes?.[0]?.date,onClear:()=>v.clearDate(),onFocus:o,tabIndex:0,readOnly:!0,clearButtonType:{xs:"hidden",lg:v.chosenDates.focusedInput&&v.chosenDates?.dateFrom?"force":"hidden"}})),renderDateHints())})},ToursDepartureSuggestContent=({departures:e,isError:t,size:a})=>{let n=(0,E.Ei)(e=>r(81568)(`./${e}/index.json`));return!e||t?m.createElement(W.vQ,null,n("error")):e.length?e.map(e=>m.createElement(U.z,{value:e.hiddenValue?.geoPoint.id??"",key:e.hiddenValue?.geoPoint.id},m.createElement(V.bL,{size:convertFormGroupSizeToCellSize(a,!0),addonSize:"none"},m.createElement(Z.cM,{label:e.hiddenValue?.geoPoint.name,isLabelAccent:!0,emphasized:!0,...(0,d.ZP)("suggest-item-name")})))):m.createElement(W.vQ,null,n("nothing_found"))};function ToursDeparturePointView({suggest:e,searchParams:t,theme:a,onErrorMessageClose:o,hasError:s,onFocus:i,errorMessage:u,size:c}){let d=(0,E.Ei)(e=>r(81568)(`./${e}/index.json`)),p=(0,l.Vt)({value:{xs:"modal",lg:"dropdown"}}),h=(0,L.r)(),g=(0,n.R)(e),{items:y,isError:f}=g.getDepartures(),b=(0,n.R)(t,{sync:!0}).routes[0].from,[P,T]=(0,m.useState)(""),setFromPoint=e=>{t.routes[0].from=e},v=y.filter(e=>{let t=e.geoPoint.name.toLowerCase(),r=P.trim().toLowerCase();return!r||t.startsWith(r)}).map((e,t)=>({value:e.geoPoint.id,hiddenValue:{...e,index:t}})),onValueSelect=e=>{e.hiddenValue&&setFromPoint(e.hiddenValue.geoPoint)},onChange=e=>{if(T(e.currentTarget.value),b.name!==e.currentTarget.value){let t={type:"unknown",name:e.currentTarget.value};setFromPoint(t)}};return useValidationTooltipTimeout({enabled:!!u,callback:o}),(0,m.useEffect)(()=>{e.loadDepartures()},[e]),m.createElement(N.X,{open:!!u,content:m.createElement(x.Dr,{color:"primary"},u),side:"modal"===p?"bottom":"top",maxWidth:"targetWidth",onClick:o,onClickOutside:o,position:"start"},({ref:e})=>m.createElement(W.qY,{...h,position:{xs:"top",lg:"left"},tabIndex:0,onFocus:i,containerRef:e,containerStyle:p??"modal",value:b.name,items:v,label:d("from"),modalProps:{title:d("from"),minHeight:"99%"},hasError:s,dropdownProps:{maxHeight:450,minWidth:"300px",flip:!1},onValueSelect:onValueSelect,renderContent:({items:e})=>m.createElement(ToursDepartureSuggestContent,{departures:e,size:c,isError:f}),wrapperProps:getThemeAttribute(a),modalInputProps:{placeholder:b.name,value:P,onChange:e=>{T(e.currentTarget.value)}},selectFirstItemOnEnterKeyPress:"modal"===p?""!==P:""!==b.name,onChange:onChange,onClose:e=>{e.items&&e.items.length>0&&"dropdown"===e.style&&"select"!==e.reason&&""!==b.name&&"unknown"===b.type&&setFromPoint(e.items[0].hiddenValue.geoPoint),T("")}}))}let ToursDestinationsSuggestContent=e=>{let{suggest:t}=e,a=(0,E.Ei)(e=>r(81568)(`./${e}/index.json`)),o=(0,n.R)(t),{isError:s,items:i}=o.getDestinations();if(s&&!i.length)return m.createElement(W.vQ,null,a("error"));let l=o.splitDestinationsByType();return l.map(([e,t])=>m.createElement(m.Fragment,{key:e},e&&m.createElement(W.to,null,m.createElement(x.Dr,{color:"neutral-secondary",size:"paragraph-small"},a(e))),t.map(e=>m.createElement(W.uj,{value:e.geoPoint.id,key:e.geoPoint.id},m.createElement(j.Rm,null,m.createElement(Z.cM,{label:e.geoPoint.name,isLabelAccent:!0,emphasized:!0}))))))};function ToursDestinationsPointView(e){let{suggest:t,searchParams:r,...a}=e,o=(0,n.R)(t),{isDefaultItems:s}=o.getDestinations(),i=o.splitDestinationsByType(),{to:l}=(0,n.R)(r,{sync:!0}).routes[0],u=i.reduce((e,t)=>[...e,...t[1]],[]).map((e,t)=>({value:e.geoPoint.id,hiddenValue:{...e,index:t}})),c=(0,m.useCallback)(e=>{t.loadDestinations({value:e})},[t]);return m.createElement(RoutePointView,{...a,point:l,setPoint:e=>{r.routes[0].to=e},items:u,isDefaultItems:s,loadItems:c,renderContent:()=>m.createElement(ToursDestinationsSuggestContent,{suggest:t})})}let AgeInfoModalContent=()=>{let e=(0,E.Ei)(e=>r(71580)(`./${e}/index.json`));return m.createElement("div",{className:(0,f.yl)(350)},m.createElement(x.P,{size:"paragraph-medium",hasExtraPaddingTop:!0},e("age_group_general_paragraph_1")))},eV=Array.from({length:18},(e,t)=>t),ChildrenModalContent=()=>{let{isOpen:e,setOpen:t}=(0,L.r)({initialIsOpen:!1}),a=(0,E.Ei)(e=>r(71580)(`./${e}/index.json`));return m.createElement(m.Fragment,null,m.createElement(j.Rm,{sizeContrast:"medium-small",className:(0,c.Z)((0,f.yl)(200),(0,h.j)({xs:"none",lg:"flex"}))},m.createElement(Z.cM,{emphasized:!0,isLabelAccent:!0,label:a("title-childrenModal")}),m.createElement(Z.cM,{label:a("subtitle-childrenModal")})),m.createElement("div",{className:(0,f.yl)(200)},eV.map(e=>m.createElement(B.h,{value:e,key:e},m.createElement(V.bL,{addonSize:"none",size:"medium",contrast:"small"},m.createElement(Z.cM,{label:a("age",{found:0!==e,n:e}),emphasized:!0,expanded:!0}))))),m.createElement(p.zx,{className:(0,f.yl)(300),color:"secondary",size:400,firstLabel:a("age_informer_button"),fullWidth:!0,leftAddon:m.createElement(y.V,{icon:"info-circle"}),onClick:()=>{t(!e)}}),m.createElement(Y.u_,{isOpen:e,setOpen:t,title:a("why_choose_age"),hasBackButton:!1,size:"small"},m.createElement(AgeInfoModalContent,null)))},TravelersModalContent=({travelers:e,onClose:t})=>{let[a,o]=m.useState(!1),s=(0,n.R)(e),i=(0,E.Ei)(e=>r(71580)(`./${e}/index.json`)),{adults:l,children:u}=s.splitAdults(),g=l.length,b=1===l.length,{child:P,infant:T,adult:v}=e.getCountsByType(),C=4<=v,D=3<=P+T,handleDeleteChild=t=>{e.remove(t)},handleButtonClick=()=>{o(!a)};return m.createElement(m.Fragment,null,m.createElement(PassengersCounter,{isMinusDisabled:b,isPlusDisabled:C,value:l.length,openPlusTooltipOnClick:C,plusTooltipContent:i("max_travelers",{count:4}),autoClosePlusTooltip:!0,autoCloseMinusTooltip:!0,title:i("adults"),subtitle:i("initial_adult_age"),className:(0,f.E9)(100),onMinusClick:()=>{1!==g&&e.remove(l[l.length-1].id)},onPlusClick:()=>{e.add(null)}}),u.map(({id:e,age:t},r)=>m.createElement(ChildPassenger,{key:e,age:t,className:0!==r?(0,f.E9)(200):void 0,onDeleteClick:()=>{handleDeleteChild(e)}})),m.createElement(R.z,{containerStyle:{xs:"modal",lg:"dropdown"},size:700,onChange:t=>{e.add(t),o(!1)},isOpen:a,renderContent:()=>m.createElement(ChildrenModalContent,null),setOpen:o,modalProps:{title:i("title-childrenModal"),subtitle:i("subtitle-childrenModal"),closeOnClickOutside:!0,closeOnCloseButtonClick:!0},dropdownProps:{closeOnClickOutside:!0,stopMouseDownPropagation:!0,useAvailableScreenHeight:!0,minHeight:"300px",minWidth:"330px"}},({ref:e})=>m.createElement(p.zx,{ref:e,className:(0,c.Z)((0,f.E9)(200),(0,f.yl)({xs:0,lg:300})),disabled:D,leftAddon:m.createElement(y.V,{icon:"person-child"}),size:400,color:"secondary",firstLabel:i("add_child_button"),onClick:handleButtonClick,fullWidth:!0,...(0,d.ZP)("add_child_button")})),m.createElement(p.zx,{className:(0,c.Z)((0,f.E9)(350),(0,h.j)({lg:"none"})),size:500,fullWidth:!0,color:"primary",type:"button",firstLabel:i("ready"),onClick:t}))},TravelersModal=({searchParams:e,initiated:t,theme:a})=>{let[o,s]=m.useState(!1),i=(0,E.Ei)(e=>r(71580)(`./${e}/index.json`)),l=(0,n.R)(e),{child:u,adult:c,infant:d}=l.travelers.getCountsByType(),p=i("input_value",{childCount:u+d,adultCount:c}),handleInputFocus=()=>{s(!o)};return m.createElement(R.z,{size:700,containerStyle:{xs:"modal",lg:"dropdown"},isOpen:o,renderContent:()=>m.createElement(TravelersModalContent,{travelers:e.travelers,onClose:()=>{s(!1)}}),setOpen:s,modalProps:{title:i("mobile_title"),closeOnClickOutside:!0,closeOnCloseButtonClick:!0,minHeight:"auto",stopMouseDownPropagation:!1},dropdownProps:{closeOnClickOutside:!0,position:"end",minWidth:"370px"}},({ref:e})=>m.createElement(k.I,{wrapperClassName:`${ee.Z.passengers} ${(0,f.yl)({xs:300,lg:0})}`,containerRef:e,position:{lg:"middle-horizontal",xl:"middle-horizontal"},"data-ti":"travelers_input",type:"text",label:i("input_label"),value:t?p:"",onFocus:handleInputFocus,readOnly:!0,clearButtonType:"hidden",wrapperProps:getThemeAttribute(a)}))},eZ=["from","to","date"],ToursFormView=({model:e,inputsTheme:t,hideHints:a=!1,size:o})=>{let{userway:s}=(0,b.w5)(),i=(0,E.Ei)(e=>r(39)(`./${e}/index.json`)),l=(0,n.R)(e),{validationEnabled:u}=l.state,{result:c}=u?l.validationResult:{result:null},[y,P]=(0,m.useState)(null),T=c?.routes?.[0],v=(()=>{if(!T)return null;if(y)for(let e=0;e<eZ.length;e++){let t=eZ[e];if(T[t]&&y===t)return t}for(let e=0;e<eZ.length;e++){let t=eZ[e];if(T[t])return t}return null})(),[C,D]=(0,m.useState)({from:!1,to:!1,date:!1}),w="date"===v&&!C.date,_=(0,m.useCallback)(()=>{D(e=>({...e,date:!0}))},[]);useValidationTooltipTimeout({enabled:w,callback:_}),(0,m.useEffect)(()=>{e.init()},[e]);let S=o&&"object"!=typeof o?o:{...ea,...o};return m.createElement(g.cw,{size:S,layout:{xs:"vertical",xl:"horizontal"},...(0,d.yT)("tours-search-form")},m.createElement("div",{className:ee.Z.searchForm},m.createElement("div",{className:`${ee.Z.firstSubGroup} ${(0,g.dm)({xs:["none"],lg:["bottom"],xl:["none"]})}`},m.createElement("div",{className:ee.Z.departure},m.createElement(ToursDeparturePointView,{size:S,searchParams:e.searchParams,suggest:e.suggest,theme:t,hasError:!!T?.from,errorMessage:"from"!==v||C.from?void 0:eN[T?.from?.errors?.[0]?.type],onFocus:()=>{u&&P("from")},onErrorMessageClose:()=>{D(e=>({...e,from:!0}))}}),!a&&m.createElement("div",{className:`${(0,h.j)({xs:"none",xl:"inline-flex"})} ${(0,f.E9)(200)} ${(0,f.SG)(100)}`},ek.map(t=>m.createElement(p.zx,{color:"secondary-neutral",size:en(S),key:t.name,onClick:()=>{e.searchParams.routes[0].from=t},...(0,d.yT)("fromHint")},t.name)))),m.createElement("div",{className:ee.Z.arrival},m.createElement(ToursDestinationsPointView,{product:"tours",position:{xs:"middle-vertical",lg:"right",xl:"middle-horizontal"},onFocus:()=>{u&&P("to")},label:i("to"),fieldName:"to",searchParams:e.searchParams,suggest:e.suggest,hasError:!!T?.to,errorMessage:"to"!==v||C.to?void 0:eN[T?.to?.errors?.[0]?.type],tabIndex:0,onErrorMessageClose:()=>{D(e=>({...e,to:!0}))},theme:t}),!a&&m.createElement("div",{className:`${(0,h.j)({xs:"none",xl:"inline-flex"})} ${(0,f.E9)(200)} ${(0,f.SG)(100)}`},ex.map(t=>m.createElement(p.zx,{color:"secondary-neutral",size:en(S),key:t.name,onClick:()=>{e.searchParams.routes[0].to=t},...(0,d.yT)("toHint")},t.name))))),m.createElement("div",{className:ee.Z.secondSubGroup},m.createElement(ToursDates,{model:e,inputsTheme:t,hideHints:a,onDateFocus:()=>{u&&P("date")},showDateValidationTooltip:w,onHideDateValidationTooltip:_,size:S,errorText:eN[T?.date?.errors?.[0]?.type]}),m.createElement(NightsSelectionModal,{searchParams:e.searchParams,initiated:l.state.initiated,theme:t}),m.createElement(TravelersModal,{searchParams:e.searchParams,initiated:l.state.initiated,theme:t}),m.createElement("div",{className:ee.Z.submitButton},m.createElement(p.zx,{isLoading:l.submitted,position:{lg:"right"},fullWidth:!0,color:"primary",type:"button","data-ti":"submit-button",onClick:()=>{e.validationResult?.isValid||s?.({title:"search_form_error_shown",type:"special",product:"tour",validation_errors:getLoggingErrors$1(e.validationResult)}),e.submit(),P(null),D({from:!1,to:!1,date:!1});let{from:t,to:r,date:a}=e.searchParams.routes[0],n="toursDeparture"===t.type?{departure_geo_id:t.id}:{},o="toursDestination"===r.type?{arrival_geo_id:r.id}:{};s?.({title:"search_form_search_click",product:"tour",search_id:e.submitter.searchId,...n,...o,...getDepartureDate(a),route_type:"oneway",passenger_count:e.searchParams.travelers.list.length,...getPassengersByAgesParams(e.searchParams.travelers)})},...getThemeAttribute(t)},i("find_tours"))))))};function createToursFormModel({toursHost:e,toursSuggestHost:t,searchParams:r,lastSearch:n,toursSubmitter:s,logError:i,renderEmptyFieldsOnSsr:l,holidaysApiHost:u,suggestLoader:m,utmParams:c}){let d=n??new ToursLastSearch,p=(0,o.n)(e),h=m??new ToursSuggestLoader(t??(0,o.e)(p,"tours."));return(0,a.sj)(new ToursFormModel({searchParams:r,suggest:new ToursSuggest(h,i),validator:new ToursValidator,lastSearch:d,searchParamsInitializer:new ToursSearchParamsInitializer,submitter:s||new ToursSubmitter({toursHost:p,utmParams:c}),holidaysApiHost:void 0===u?(0,o.b)(p,"tours."):u,renderEmptyFieldsOnSsr:l}))}let ej={multi:"Все",avia:"Авиабилеты",train:"Ж/д билеты",bus:"Автобусы",etrain:"Электрички",hotel:"Отели",tours:"Туры",go:"Приключения",aeroexpress:"Аэроэкспрессы",jarvel:"Джарвел"};(0,G.ZP)(ej,"hotel"),(0,G.ZP)(ej,"avia"),(0,G.ZP)(ej,"train"),(0,G.ZP)(ej,"bus"),(0,G.ZP)(ej,"etrain"),(0,G.ZP)(ej,"go"),(0,G.ZP)(ej,"tours"),(0,G.ZP)(ej,"aeroexpress")}}]);